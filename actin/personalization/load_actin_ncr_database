#!/usr/bin/env bash

source message_functions || exit 1
source locate_files || exit 1
source actin_config || exit 1
source database_functions || exit 1

actin_credentials="$(actin_writer_sql_credentials)"
personalization_jar="$(locate_actin_personalization_jar)"

# TODO (KD): Switch to "actin_ncr" once new NCR dataset is loadable. 
actin_database_name="actin_ncr_delivery3"

ncr_file="$(locate_ncr_crc_dataset_delivery3_analysis_vm)"

db_user=$(extract_database_user "${actin_credentials}")
db_pass=$(extract_database_password "${actin_credentials}")
db_url=$(construct_database_url "${actin_credentials}" "${actin_database_name}")

info "Loading NCR dataset into ACTIN NCR database"

java -cp ${personalization_jar} com.hartwig.actin.personalization.ncr.database.NcrDatabaseLoaderApplicationKt \
    -ncr_file "${ncr_file}" \
    -db_user ${db_user} -db_pass ${db_pass} -db_url ${db_url} \
    "$@"

