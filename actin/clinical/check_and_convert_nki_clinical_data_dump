#!/usr/bin/env bash

source message_functions || exit 1
source actin_functions || exit 1

dir=$1 && shift

if [[ -z "${dir}" ]]; then
    error "Parameters missing. Exiting."
fi

info "Cleaning and converting NKI clinical data in ${dir}"

for json_file in $(ls ${dir}/*.json); do
    json_name=$(basename ${json_file})
    hashed_id=$(echo ${json_name} | cut -d "." -f 1)

    info "Looking up NKI ACTIN ID for ${hashed_id}"
    actin_id=$(find_nki_actin_id_from_hash ${hashed_id})

    if [[ -z "${actin_id}" ]]; then
        error "Could not resolve ACTIN ID for NKI hash ${hashed_id}"
    fi

    info " Resolved ACTIN ID to be ${actin_id} for ${hashed_id}"
#    mv "${json_file}" "${dir}/${actin_id}.json"
done

info "Done!"