#!/usr/bin/env bash

source message_functions || exit 1
source locate_files || exit 1
source database_functions || exit 1

tum_sample=$1 && shift

if [[ -z "${tum_sample}" ]]; then
    error "Patient or jar Parameters missing. Exiting."
fi

actin_jar="$(locate_actin_jar_on_vm)"
patient_json="$(locate_actin_molecular_directory)/${tum_sample}.patient_record.json"

database="actin_cohort"
credentials="$(prod_writer_sql_credentials)"
db_user=$(extract_database_user "${credentials}")
db_pass=$(extract_database_password "${credentials}")
db_url=$(construct_database_url "${credentials}" "${database}")

info "Loading ${tum_sample} into ACTIN database '${database}'"

java -cp ${actin_jar} com.hartwig.actin.database.molecular.MolecularLoaderApplicationKt \
    -patient_json ${patient_json} \
    -db_user ${db_user} -db_pass ${db_pass} -db_url ${db_url} \
    "$@"
