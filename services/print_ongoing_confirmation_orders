#!/usr/bin/env bash

INNOVATION_RETENTION_DAYS=14
SERVICES_RETENTION_DAYS=90

echo -e "Submission\tOrder\tSource\tExtra\tOutput\tSampleCount"

ongoing_orders=$(curl -s -X 'GET' -H 'accept: */*' 'http://lama.prod-1/api/registration/order-confirmations?filter-completed=true')
ongoing_orders=$(echo "${ongoing_orders}" | tr -d ']["')
for order in ${ongoing_orders//,/ }
do
    order_info=$(curl -s -X 'GET' -H 'accept: */*' "http://lama.prod-1/api/registration/order-confirmation/${order}")
    confirmation_number=$(echo "${order_info}" | jq -r '.confirmationNumber')
    project_category=$(echo "${order_info}" | jq -r '.projectCategory')
    count=$(echo "${order_info}" | jq '.servicesSamples | .[] | length')
    output=$(echo "${order_info}" | jq -r '.servicesSamples | .[0].dataOutputLevel')
    if [[ "${confirmation_number}" == "INN*" ]]
    then
        retention=${INNOVATION_RETENTION_DAYS}
    else
        retention=${SERVICES_RETENTION_DAYS}
    fi
    echo -e "NA\t${confirmation_number}\t${project_category}\t${retention}\tNA\t${output}\t${count}"
done